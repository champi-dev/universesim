(()=>{var t={927:t=>{function e(t){const{clusters:e,camera:n,screenWidth:s,screenHeight:r,errorThreshold:o}=t,a=[];e&&e.length>0&&e.forEach((t=>{const e=function(t,e,n,s,r){const o=t.cluster||t,a=o.bounds;if(!a||!a.min||!a.max)return null;const i={x:(a.min.x+a.max.x)/2,y:(a.min.y+a.max.y)/2,z:(a.min.z+a.max.z)/2},c=e.position.x-i.x,l=e.position.y-i.y,u=e.position.z-i.z,m=Math.sqrt(c*c+l*l+u*u),x=a.max.x-a.min.x,h=a.max.y-a.min.y,f=a.max.z-a.min.z,d=Math.sqrt(x*x+h*h+f*f),y=e.fov*Math.PI/180,M=d/m*s/(2*Math.tan(y/2)),p=o.triangleCount||1e3,g=M/Math.max(1,Math.sqrt(p));let b=0;g<.25*r?b=4:g<.5*r?b=3:g<r?b=2:g<2*r&&(b=1);return{level:b,error:g,triangleCount:p}}(t,n,0,r,o);e&&a.push({meshId:t.meshId,clusterId:t.cluster?t.cluster.id:t.id,selectedLevel:e.level,error:e.error,triangleCount:e.triangleCount})})),self.postMessage({type:"LOD_SELECTION_COMPLETE",results:a})}function n(t){const{vertices:e,indices:n,targetRatio:r}=t,o=function(t,e,n){const r=t instanceof Float32Array?t:new Float32Array(t),o=e instanceof Uint32Array?e:new Uint32Array(e),a=Math.floor(o.length*n),i=new Map;for(let m=0;m<o.length;m+=3){const t=o[m],e=o[m+1],n=o[m+2];s(i,t,m/3),s(i,e,m/3),s(i,n,m/3)}const c=new Uint32Array(a),l=Math.ceil(o.length/a);let u=0;for(let s=0;s<o.length&&u<a-2;s+=3*l)s+2<o.length&&(c[u++]=o[s],c[u++]=o[s+1],c[u++]=o[s+2]);return{vertices:Array.from(r),indices:Array.from(c.slice(0,u))}}(e,n,r);self.postMessage({type:"SIMPLIFICATION_COMPLETE",result:o})}function s(t,e,n){t.has(e)||t.set(e,[]),t.get(e).push(n)}self.onmessage=function(t){const{type:s,data:r}=t.data;switch(s){case"SELECT_LODS":e(r);break;case"SIMPLIFY_GEOMETRY":n(r);break;case"FRUSTUM_CULL":!function(t){const{objects:e,frustumPlanes:n}=t,s=[],r=[];e.forEach((t=>{!function(t,e){for(let n=0;n<6;n++){const s=e[n],r=s.x>0?t.max.x:t.min.x,o=s.y>0?t.max.y:t.min.y,a=s.z>0?t.max.z:t.min.z;if(s.x*r+s.y*o+s.z*a+s.w<0)return!1}return!0}(t.bounds,n)?r.push(t.id):s.push(t.id)})),self.postMessage({type:"FRUSTUM_CULL_COMPLETE",visible:s,culled:r})}(r);break;case"COMPUTE_ERRORS":!function(t){const{clusters:e,camera:n,screenWidth:s,screenHeight:r}=t,o=new Float32Array(e.length);e.forEach(((t,e)=>{const s={x:(t.bounds.min.x+t.bounds.max.x)/2,y:(t.bounds.min.y+t.bounds.max.y)/2,z:(t.bounds.min.z+t.bounds.max.z)/2},a=n.position.x-s.x,i=n.position.y-s.y,c=n.position.z-s.z,l=Math.sqrt(a*a+i*i+c*c),u=t.bounds.max.x-t.bounds.min.x,m=t.bounds.max.y-t.bounds.min.y,x=t.bounds.max.z-t.bounds.min.z,h=Math.sqrt(u*u+m*m+x*x),f=n.fov*Math.PI/180,d=h/l*r/(2*Math.tan(f/2)),y=t.triangleCount||1e3;o[e]=d/Math.max(1,Math.sqrt(y))})),self.postMessage({type:"ERROR_COMPUTATION_COMPLETE",errors:Array.from(o)})}(r);break;default:console.warn("Unknown worker message type:",s)}},t.exports&&(t.exports={handleLODSelection:e,handleGeometrySimplification:n})}},e={};(function n(s){var r=e[s];if(void 0!==r)return r.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,n),o.exports})(927)})();
//# sourceMappingURL=927.1822a437.chunk.js.map